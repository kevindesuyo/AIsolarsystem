# 開発計画 TODO

## 進捗サマリ
- [x] フェーズ0：準備期間 完了
- [ ] フェーズ1：ツールチェーン整備 完了
- [ ] フェーズ2：物理シミュレーション刷新 完了
- [ ] フェーズ3：UX & 機能拡張 完了
- [ ] フェーズ4：品質保証とリリース 完了
- [ ] クロスフェーズ活動 継続中

## 機械検証フレームワーク
- `automation/todo-checks.json` に検証条件を定義し、`npm run verify:todo` で一括実行する
- チェック設計指針は `docs/automation/todo_verification_strategy.md` を参照する
- 各タスクは該当アーティファクト/テストが揃えば自動で完了判定される

---

## 全体ビジョン
- [ ] 物理エンジンと描画基盤を刷新し、安定したリアルタイム太陽系シミュレーションを提供する
- [ ] UI/UX、アクセシビリティ、国際化対応を施し、教育・デモ用途に耐える完成度を実現する
- [ ] CI/CD・テスト・メトリクスを整備し、継続的な品質向上と将来拡張に備える

## タイムライン概要
- [x] フェーズ0（週0）計画・リサーチ完了
- [ ] フェーズ1（週1-2）基盤強化完了
- [ ] フェーズ2（週3-5）シミュレーション刷新完了
- [ ] フェーズ3（週6-8）UX向上完了
- [ ] フェーズ4（週9-10）品質保証体制完了

---

## フェーズ0：準備期間（週0）
**目的:** 設計固めとリスク把握  
**完了条件:** 詳細仕様と対応方針が合意済み

- [x] プロジェクトキックオフ資料を作成し、方針・リスク・成功指標を共有する
- [x] 既存コードの技術負債棚卸しメモをカテゴリ別に整理する
- [x] 依存技術アップデート（React 19、Vite/Vitest 等）のリスク分析を完了する
- [x] ステークホルダーと優先順位・納期・レビュー体制を合意する

---

## フェーズ1：ツールチェーン整備（週1-2）
**目的:** 強固な開発基盤を構築する  
**完了条件:** 型チェック・Lint・整形・CIが自動実行される状態

### 1.1 TypeScript/ESLint強化
- [ ] `tsconfig.json`で`noImplicitAny`を有効化し、`allowJs`を無効化する
- [ ] パスエイリアスとインポート順序ルールを追加する
- [ ] ESLintカスタム設定（React Hooks/Accessibility ルール等）を導入する
- [ ] Prettier + lint-staged を設定し、`package.json`スクリプトを更新する
- [ ] Git Hook または CI による自動整形・Lint 強制を有効にする

### 1.2 ビルド基盤移行準備
- [ ] Vite/Next.js などの候補を比較検討し、移行先を決定する
- [ ] 移行計画書（タスク分解・リスク・ロールバック手順）を作成する
- [ ] `src/App.test.tsx` を Canvas/Hooks スモークテストに差し替える
- [ ] Jest 設定（Canvas/WebGL モック、`jest-dom`拡張、`setupTests.ts`整備）を更新する

### 1.3 ドキュメント/メンテナンス
- [ ] `README.md` にライセンス、環境変数、主要コマンドを追記する
- [ ] `.env.example` と設定ロードユーティリティの骨組みを追加する
- [ ] Dependabot または Renovate を導入し、更新ポリシーを定義する
- [ ] `PROJECT_MAINTENANCE_REPORT.md` を最新計画と同期させる

---

## フェーズ2：物理シミュレーション刷新（週3-5）
**目的:** 高精度・高性能な物理演算と描画を実現  
**完了条件:** 新エンジンでの挙動が安定し、性能指標が改善

### 2.1 シミュレーションループ再設計
- [ ] `useSimulation.ts` からアニメーションループを分離し、Web Worker 化の PoC を実施する
- [ ] Worker ⇔ UI 間の状態同期プロトコル（差分配信、メッセージ型）を設計する
- [ ] メインスレッドは固定間隔で React 状態を更新し、描画は Worker からのデータで行う
- [ ] フレームスキップ・遅延検知メトリクスを収集し、デバッグ用 HUD を仮実装する

### 2.2 物理エンジン強化
- [ ] 重力・衝突・外力の計算モジュールを分割し、拡張インターフェイスを定義する
- [ ] 新積分法（Symplectic Euler または RK4）と可変時間ステップを実装する
- [ ] 衝突判定と合体処理をリファクタリングし、エネルギー収支ログを出力する
- [ ] 保存量検証ツールを自動チェック化し、異常値を UI へ通知する

### 2.3 レンダリング/リソース管理
- [ ] `canvas/draw.ts` の責務を背景・トレイル・惑星・HUD に分割する
- [ ] ウィンドウリサイズと DPR 変化に対応し、メモリリークを検証する
- [ ] テクスチャプリロードとフェールセーフ（代替色・通知）を実装する
- [ ] WebGL レンダリングの PoC を作成し、性能比較レポートをまとめる

---

## フェーズ3：UX & 機能拡張（週6-8）
**目的:** 教育・デモ用途に適した操作体験を提供  
**完了条件:** 主要ユーザーストーリーが成立し、UX 課題が解消

### 3.1 デザインシステム/レイアウト
- [ ] デザイントークンとレイアウトコンポーネントを整備する
- [ ] ControlPanel/PhysicsPanel をレスポンシブ対応で再設計する
- [ ] 多言語対応フレームワークを導入し、ja/en 辞書と切替 UI を実装する
- [ ] ユーザー設定（縮尺、単位系、表示モード）をローカル保存できるようにする

### 3.2 学習支援機能
- [ ] 軌道予測、速度ベクトル、エネルギー変化を可視化する HUD を実装する
- [ ] シナリオプリセット（共鳴軌道など）を定義ファイル化し、UI から読み込む
- [ ] 状態保存/共有機能（URL・JSON エクスポート）を提供し、バリデーションを実装する
- [ ] ガイド付きオンボーディングとツールチップ、ヘルプモーダルを実装する

### 3.3 アクセシビリティと操作性
- [ ] キーボード操作とスクリーンリーダー ARIA ラベルを拡充する
- [ ] `useCanvasInteraction.ts` にスナップ/グリッド/ホバーツールチップを追加する
- [ ] カラーブラインド・低視力向けテーマと Reduced Motion モードを提供する
- [ ] ユーザビリティテストを実施し、改善バックログを作成する

---

## フェーズ4：品質保証とリリース（週9-10）
**目的:** 自動テストとリリースフローを整備し運用を安定化  
**完了条件:** CI/CD 上でビルド・テスト・デプロイが自動化され、監視体制が構築済み

### 4.1 テスト体系構築
- [ ] 物理計算の単体テスト（`simulationEngine.ts`、`utils/physics.ts`）を追加する
- [ ] Hook/コンポーネントのユニットテスト（Canvas モック、Planet CRUD、予測ロジック）を実装する
- [ ] Playwright による E2E シナリオ（ドラッグ操作・プリセット・共有リンク）を整備する
- [ ] カバレッジレポートと閾値を設定し、テストギャップをレポート化する

### 4.2 パイプライン＆配布
- [ ] GitHub Actions CI（lint、type-check、test、Playwright、ビルド、バンドルサイズ）を構築する
- [ ] PWA 対応（Service Worker、`manifest.json` 更新、オフラインキャッシュ）を実装する
- [ ] デプロイパイプライン（Vercel/Netlify + GitHub Pages バックアップ）を整備する
- [ ] セマンティックバージョニングとリリースノート自動生成を開始する

### 4.3 運用・監視
- [ ] ランタイムメトリクス（FPS、Worker 遅延、エネルギー誤差）を計測し HUD/ダッシュボード化する
- [ ] Sentry 等のエラートラッキングを導入し、重大アラート閾値を設定する
- [ ] 利用状況ログを匿名化収集し、プライバシーポリシーを整備する
- [ ] 運用ガイド（障害対応手順、リリースチェックリスト）を作成する

---

## クロスフェーズ活動
- [ ] 週次ステータスレポートを作成し、進捗・リスク・ブロッカーを共有する
- [ ] 各フェーズ終了時にレトロスペクティブを実施し、アクションアイテムを登録する
- [ ] バックログ管理体制（Issue テンプレート、優先度ラベル、コードオーナー）を整備する
- [ ] パフォーマンス予算と SLO を策定し、定期的に測定・報告する

## リスクと軽減策メモ
- [ ] Worker 移行による複雑化リスク → 初期 PoC とベンチマークを行い、段階的に導入する
- [ ] 物理エンジン刷新による回帰リスク → 保存量テストとゴールデンデータを用意し、旧実装を暫定併存させる
- [ ] UI 改修の規模拡大による遅延リスク → デザインシステム整備とコンポーネントカタログ化で再利用性を高める
- [ ] テスト自動化コスト → 重要経路（エンジン、保存/読み込み、操作）から優先的にテストを追加する
